# Render.com Blueprint for AI MongoDB Query Generator
# This file defines all services for deployment on Render.com

services:
  # ===========================================
  # API Gateway Service
  # ==========================================
  - type: web
    name: ai-query-api-gateway
    env: docker
    region: oregon
    plan: free
    dockerfilePath: Dockerfile.api-gateway
    dockerContext: .
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DATABASE
        value: ai_query_generator
      - key: GOOGLE_API_KEY
        sync: false
      - key: LLM_PROVIDER
        value: google_gemini
      - key: VALIDATOR_SERVICE_URL
        fromService:
          type: web
          name: ai-query-validator
          envVarKey: RENDER_INTERNAL_URL
      - key: EXECUTOR_SERVICE_URL
        fromService:
          type: web
          name: ai-query-executor
          envVarKey: RENDER_INTERNAL_URL
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: LOG_LEVEL
        value: INFO
      - key: RATE_LIMIT_PER_MINUTE
        value: 100

  # ==========================================
  # Query Validator Service
  # ==========================================
  - type: web
    name: ai-query-validator
    env: docker
    region: oregon
    plan: free
    dockerfilePath: Dockerfile.query-validator
    dockerContext: .
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DATABASE
        value: ai_query_generator
      - key: LOG_LEVEL
        value: INFO

  # ==========================================
  # Query Executor Service
  # ==========================================
  - type: web
    name: ai-query-executor
    env: docker
    region: oregon
    plan: free
    dockerfilePath: Dockerfile.query-executor
    dockerContext: .
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: ENVIRONMENT
        value: production
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DATABASE
        value: ai_query_generator
      - key: LOG_LEVEL
        value: INFO
      - key: MAX_QUERY_RESULTS
        value: 1000

databases: []
